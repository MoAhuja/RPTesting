// <auto-generated />

{{#with this as |res|}}
using System;
using System.Net;
{{#if res.includeCancellationToken}}
using System.Threading;
{{/if}}
using System.Threading.Tasks;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using Microsoft.TypeSpec.ProviderHub.Controller;
using {{nameSpace}}.Service.Models;
using {{nameSpace}}.Service.Controllers;

namespace {{nameSpace}}.Service
{
    /// <summary>
    /// Controller for user RP operations on the {{res.name}} resource.
    /// </summary>
    [ApiController]
    public abstract class {{res.name}}ControllerBase : ControllerBase
    {
        protected readonly ILogger<{{res.name}}ControllerBase> _logger;

        protected {{res.name}}ControllerBase(ILogger<{{res.name}}ControllerBase> logger)
        {
            _logger = logger;
        }
{{#each operations as |operation operationIndex|}}

{{#if (getOperationAction operation)}}
{{#if (notCustomOp operation)}}
        /// <summary>
        /// Validate the request to {{getOperationAction operation}} the {{res.name}} resource.
        /// </summary>
{{#each operation.parameters as |parameter index |}}
        /// <param name="{{parameter.name}}">
        {{> renderComment content=parameter.description}}
        /// </param>
{{/each}}
        /// <returns> A ValidationResponse indicating the validity of the {{getOperationAction operation}} request.</returns>
        [HttpPost]
        [Route({{res.serviceName}}ServiceRoutes.{{res.name}}Validate{{getOperationAction operation}})]
        [ProducesResponseType((int)HttpStatusCode.OK, Type = typeof(ValidationResponse))]
        public async Task<ValidationResponse> Validate{{getOperationAction operation}}Async({{decl operation}})
        {
            _logger.LogInformation($"Validate{{getOperationAction operation}}Async()");
{{#if (isDefined operation.requestParameter)}}
            var modelValidation = ValidationHelpers.ValidateModel({{operation.requestParameter.name}});
            if (modelValidation.IsValid)
            {
                modelValidation = await OnValidate{{getOperationAction operation}}Async({{call operation}});
            }

{{else}}
            var modelValidation = await OnValidate{{getOperationAction operation}}Async({{call operation}});
{{/if}}
            return modelValidation;
        }

{{/if}}
        /// <summary>
        /// {{getOperationAction operation}} the {{res.name}} resource.
        /// </summary>
{{#each operation.parameters as |parameter index|}}
        /// <param name="{{parameter.name}}"> 
        {{> renderComment content=parameter.description}}
        /// </param>
{{/each}}
        /// <returns> The {{res.name}} resource.</returns>
        [Http{{initialCaps operation.verb }}]
        [Route({{res.serviceName}}ServiceRoutes.{{res.name}}Item{{#unless (notCustomOp operation)}}{{getOperationAction operation}}{{/unless}})]
        [ProducesResponseType((int)HttpStatusCode.OK, Type = typeof({{operation.returnType}}))]
{{#if (or (eq (getOperationAction operation) "Create") (eq (getOperationAction operation) "Patch"))}}
        [ProducesResponseType((int)HttpStatusCode.Created, Type = typeof({{operation.returnType}}))]
{{/if}}
{{#if (eqi operation.verb "DELETE")}}
        [ProducesResponseType((int)HttpStatusCode.NoContent, Type = typeof({{operation.returnType}}))]
{{/if}}
        public async Task<IActionResult> {{getOperationAction operation}}Async({{decl operation}})
        {
            _logger.LogInformation("{{getOperationAction operation}}Async()");
{{#if operation.requestParameter}}
            {{operation.requestParameter.name}} = {{operation.requestParameter.name}} ?? throw new ArgumentNullException(nameof({{operation.requestParameter.name}}));

{{/if}}
            if (Request == null)
            {
                _logger.LogError($"Http request is null");
                return BadRequest("Http request is null");
            }

            return await On{{getOperationAction operation}}Async({{call operation }});

        }

        protected abstract Task<IActionResult> OnValidate{{getOperationAction operation}}Async({{decl operation}});

        protected abstract Task<IActionResult> On{{getOperationAction operation}}Async({{decl operation}});

{{/if}}
{{/each}}
{{#if res.hasSubscriptionList}}
        /// <summary>
        /// List Organization resources in the specified subscription.
        /// </summary>
        /// <param name="subscriptionId"> The subscription id.</param>
        /// <returns> The list of {{res.name}} Resources in the specified subscription.</returns>
        [HttpGet]
        [Route({{res.serviceName}}ServiceRoutes.{{res.name}}ListBySubscription)]
        [ProducesResponseType((int)HttpStatusCode.OK, Type = typeof({{res.specificationListModelName}}))]
        public Task<{{res.specificationListModelName}}> ListBySubscription(string subscriptionId)
        {
            _logger.LogInformation("ListBySubscriptionAsync()");
            return OnListBySubscription(subscriptionId);
        }

        protected abstract Task<{{res.specificationListModelName}}> OnListBySubscription(string subscriptionId);

{{/if}}
{{#if res.hasResourceGroupList}}
        /// <summary>
        /// List {{res.name}} resources in the specified resource group.
        /// </summary>
        /// <param name="subscriptionId"> The subscription id.</param>
        /// <param name="resourceGroupName"> The resource group name.</param>
        /// <returns> The list of {{res.name}} Resources in the specified resource group.</returns>
        [HttpGet]
        [Route({{res.serviceName}}ServiceRoutes.{{res.name}}ListByResourceGroup)]
        [ProducesResponseType((int)HttpStatusCode.OK, Type = typeof({{res.specificationListModelName}}))]
        public Task<{{res.specificationListModelName}}> ListByResourceGroupAsync(string subscriptionId, string resourceGroupName)
        {
            _logger.LogInformation("ListByResourceGroupAsync()");
            return OnListByResourceGroupAsync(subscriptionId, resourceGroupName);
        }
                
        protected abstract Task<{{res.specificationListModelName}}> OnListByResourceGroupAsync(string subscriptionId, string resourceGroupName);
{{/if}}
    }
}
{{/with}}
