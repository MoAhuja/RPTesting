import { isCollection, isMap, isScalar } from "yaml";
import { findPair } from "yaml/util";
export function getLocationInYamlScript(file, path, kind = "value") {
    var _a, _b, _c, _d;
    const node = findYamlNode(file, path, kind);
    return {
        file: file.file,
        pos: (_b = (_a = node === null || node === void 0 ? void 0 : node.range) === null || _a === void 0 ? void 0 : _a[0]) !== null && _b !== void 0 ? _b : 0,
        end: (_d = (_c = node === null || node === void 0 ? void 0 : node.range) === null || _c === void 0 ? void 0 : _c[1]) !== null && _d !== void 0 ? _d : 0,
    };
}
function findYamlNode(file, path, kind = "value") {
    let current = file.doc.contents;
    for (let i = 0; i < path.length; i++) {
        const key = path[i];
        const isLast = i === path.length - 1;
        if (isScalar(current)) {
            return current;
        }
        else if (isCollection(current)) {
            if (isLast) {
                if (kind === "value" || !isMap(current)) {
                    return current.get(key, true);
                }
                else {
                    const pair = findPair(current.items, key);
                    if (kind === "key") {
                        return pair === null || pair === void 0 ? void 0 : pair.key;
                    }
                    else {
                        return pair;
                    }
                }
            }
            else {
                current = current.get(key, true);
            }
        }
        else {
            continue;
        }
    }
    return current !== null && current !== void 0 ? current : undefined;
}
//# sourceMappingURL=diagnostics.js.map